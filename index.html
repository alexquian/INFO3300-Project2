<!DOCTYPE html>
<html>
<head>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
</head>
<body>

<h1>INFO 3300 Project 2</h1>
<h1>Terrorism & Immigration from "Muslim Ban" Countries</h1>

<style>
  h1 {
    display: block;
    text-align: center;
    font: bold;
    color: #E23926;
    font-weight: 800;
    font-family: Helvetica, sans-serif;
    margin-top: 5px;
    margin-bottom: 10px;
  }

  h2 {
    font: 20px bold;
    font-weight: 500;
    font-family: Helvetica, sans-serif;
  }

  #contentArea {
    display: block;
    margin: 0 auto;
    width: 1500px;
  }

  #attackData {
    display: inline-block;
    width: 40%;
    padding: 20px;
    vertical-align: top;
  }

  #attackData p {
    font-family: Helvetica, sans-serif;
  }

  #immigrationData {
    display: inline-block;
    width: 40%;
    margin-left: 10%;
    padding: 20px;
    vertical-align: top;
  }

  #immigrationData p {
    font-family: Helvetica, sans-serif;
  }

  #header {
    font: 28px bold;
    font-weight: 800;
    font-family: Helvetica, sans-serif;
  }

  .country {
    font: 22px bold;
    font-weight: 500;
    font-family: Helvetica, sans-serif;
  }
</style>

<div id="contentArea">
  <svg class="mapArea" height="450" width="1500" style="display: block; margin: 0 auto; margin-top: 40px;">
    <text id="header" x="950" y="40" fill="black" text-anchor="left", dominant-baseline="central">Countries Listed in Muslim Ban</text>
    <text class="country" id="Iran" x="950" y="80" fill="black" text-anchor="left", dominant-baseline="central">Iran</text>
    <text class="country" id="Iraq" x="950" y="120" fill="black" text-anchor="left", dominant-baseline="central">Iraq</text>
    <text class="country" id="Libya" x="950" y="160" fill="black" text-anchor="left", dominant-baseline="central">Libya</text>
    <text class="country" id="Somalia" x="950" y="200" fill="black" text-anchor="left", dominant-baseline="central">Somalia</text>
    <text class="country" id="Sudan" x="950" y="240" fill="black" text-anchor="left", dominant-baseline="central">Sudan</text>
    <text class="country" id="Syria" x="950" y="280" fill="black" text-anchor="left", dominant-baseline="central">Syria</text>
    <text class="country" id="Yemen" x="950" y="320" fill="black" text-anchor="left", dominant-baseline="central">Yemen</text>

  </svg>

  <div id="attackData">
    <h2>Attack Information</h2>
    <p id="summary">Click on a circle to view information about the domestic terror attack.</p>
  </div>

  <div id="immigrationData">
    <h2>Immigration Information</h2>
    <p id="info">Click on a country to view immigration data.</p>
  </div>

</div>

<script>
  const map = d3.select(".mapArea");
  const mapH = map.attr("height");
  const mapW = map.attr("width");
  const margin = {top: 35, right: 35, bottom: 35, left: 35};

  const mapHeight = mapH - margin.right - margin.left;
  const mapWidth = mapW - margin.top - margin.bottom;

  // CREATE AREA FOR US MAP and TRANSLATE
  const usMap = map.append("g")
                    .attr("transform", "translate(" + 10 + "," + 10 + ")")
                    .attr("width", 620)
                    .attr("height", mapHeight)

  const usHeight = Number(usMap.attr("height"));
  const usWidth = Number(usMap.attr("width"));

  // CREATE AREA FOR MUSLIM BAN COUNTRIES AND TRANSLATE
  const muslimMap = map.append("g")
                        .attr("transform", "translate(" + (usWidth + margin.left + 20) + "," + margin.top + ")")
                        .attr("width", 620)
                        .attr("height", mapHeight);

  const visualizeData = async() => {

    // IMPORT TERROR DATASET
    var usAttacks = await d3.csv("/datasets/usTerrorism.csv");

    // Filter out rows with missing data
    usAttacks = usAttacks.filter(usAttacks => usAttacks.summary != "");
    usAttacks = usAttacks.filter(usAttacks => usAttacks.gname != "Unknown");

    // IMPORT IMMIGRATION DATASET
    const immigration = await d3.csv("/datasets/muslimBanImmigration.csv");
    console.log(immigration);

    const usData = await d3.json("/datasets/us.json");
      let states = topojson.feature(usData, usData.objects.states);
      let project = d3.geoMercator().scale(700).center([-95.7129, 37.0902]).translate([margin.left + 330, margin.top + 200]);
      let path = d3.geoPath().projection(project);

      usMap.selectAll("path").data(states.features)
        .enter()
        .append("path")
        .attr("class", "state")
        .style("fill", "#D6D6D5")
        .style("stroke", "none")
        .attr("d", path)
        .attr("note", d => d.id);

      usMap.append("path")
        .datum(topojson.mesh(usData, usData.objects.states))
        .style("stroke", "#6A6B67")
        .style("fill", "none")
        .attr("note", d=> d.id)
        .attr("d", path);

      var circles = usMap.selectAll("circle")
        .data(usAttacks)
        .enter()
        .append("circle")
        .attr("cx", function(usAttacks) { return project([usAttacks.longitude, usAttacks.latitude])[0]; })
        .attr("cy", function(usAttacks) { return project([usAttacks.longitude, usAttacks.latitude])[1]; })
        .attr("r", 3.5)
        .attr("fill", "#E23926")
        .attr("stroke", "gray")
        .attr("stroke-width", 1.5)
        .attr("fill-opacity", .6)
        .attr("clicked", "0")
        .attr("summary", function(usAttacks) { return usAttacks.summary })
        .attr("affiliation", function(usAttacks) { return usAttacks.gname })
        .on("mouseover", function() {
            d3.select(this)
              .transition()
              .duration(500)
              .attr("r", 3.5 + 4)
              .attr("fill-opacity", 1);
        })
        .on("mouseout", function() {
          if (d3.select(this).attr("clicked") == "0") {
            d3.select(this)
              .transition()
              .duration(500)
              .attr("r", 3.5)
              .attr("fill-opacity", .6)
          }
        })
        .on("click", function() {
          circles.attr("clicked", "0")
            .transition()
            .duration(300)
            .attr("fill", "#E23926")
            .attr("stroke", "gray")
            .attr("stroke-width", 1.5)
            .attr("r", 3.5)
            .attr("fill-opacity", .6);
          d3.select(this)
            .transition()
            .duration(500)
            .attr("clicked", "1")
            .attr("fill", "white")
            .attr("stroke", "#E23926")
            .attr("stroke-width", 2)
            .attr("r", 3.5 + 6)
            .attr("fill-opacity", .8);
          d3.select("p#summary").remove();
          d3.select("p#affiliation").remove();
          d3.select("div#attackData").append("p")
            .attr("id", "summary")
            .attr("x", 0)
            .attr("y", 0)
            .text(d3.select(this).attr("summary"));
          d3.select("div#attackData").append("p")
            .attr("id", "affiliation")
            .attr("x", 0)
            .attr("y", 0)
            .text("Perpetrator Affiliation: " + d3.select(this).attr("affiliation"));
        });
  }

  visualizeData();

</script>

</body>
</html>
